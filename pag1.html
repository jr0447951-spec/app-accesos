<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generador de Accesos - Network Ops</title>
<style>
    :root { 
        --primary: #00a1ff; 
        --movistar: #5bc500;
        --dark-bg: #0f172a;
        --glass: rgba(255, 255, 255, 0.07);
    }

    /* FONDO TECNOL칍GICO UNIFICADO */
    body {
        font-family: 'Segoe UI', system-ui, sans-serif;
        margin: 0;
        padding: 20px 15px 120px;
        background: radial-gradient(circle at top right, #1e293b, var(--dark-bg));
        color: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    body::after {
        content: "";
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background-image: linear-gradient(rgba(0, 161, 255, 0.05) 1px, transparent 1px), 
                          linear-gradient(90deg, rgba(0, 161, 255, 0.05) 1px, transparent 1px);
        background-size: 30px 30px;
        z-index: -2;
    }

    header { text-align: center; margin-bottom: 20px; }
    h2 { margin: 0; font-size: 1.3rem; letter-spacing: 1px; color: white; text-transform: uppercase; }
    .subtitle { color: var(--primary); font-size: 0.8rem; font-weight: bold; }

    /* CONTENEDOR TIPO CARD GLASS */
    .form-card {
        background: var(--glass);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        padding: 20px;
        width: 100%;
        max-width: 500px;
        box-sizing: border-box;
        box-shadow: 0 15px 35px rgba(0,0,0,0.4);
    }

    label {
        display: block;
        margin: 12px 0 5px;
        font-size: 0.7rem;
        font-weight: 800;
        color: var(--primary);
        text-transform: uppercase;
    }

    input, select, textarea {
        width: 100%;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        color: white;
        font-size: 14px;
        outline: none;
    }

    input:focus, select:focus { border-color: var(--primary); }
    option { background: #1e293b; color: white; }

    /* LISTA DE SITIOS */
    #listaSitios {
        position: absolute;
        width: 100%;
        background: #1e293b;
        border-radius: 10px;
        z-index: 1000;
        max-height: 150px;
        overflow-y: auto;
        border: 1px solid var(--primary);
        margin-top: 5px;
    }
    #listaSitios div { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; font-size: 13px; }

    /* CHIPS TECNICOS */
    #tecnicosAdicionales {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        padding: 10px;
        background: rgba(0,0,0,0.2);
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .chip {
        padding: 6px 12px;
        background: rgba(255,255,255,0.1);
        border-radius: 50px;
        font-size: 11px;
        cursor: pointer;
        transition: 0.2s;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .chip.selected { background: var(--movistar); color: white; border-color: #fff; }
    .chip.disabled { opacity: 0.3; cursor: not-allowed; }

    #contadorSeleccionados { font-size: 11px; margin-top: 5px; color: #94a3b8; text-align: right; }

    textarea {
        height: 150px;
        background: rgba(0,0,0,0.5);
        color: #00ff41;
        font-family: 'Courier New', monospace;
        font-size: 11px;
        border: 1px solid rgba(0, 161, 255, 0.3);
    }

    /* BOTONES */
    button {
        padding: 14px; margin-top: 10px; width: 100%; font-size: 14px; border: none; 
        border-radius: 12px; cursor: pointer; color: white; font-weight: bold; transition: 0.3s;
    }
    #generar { background: #3b82f6; }
    #whatsapp { background: #25d366; }
    
    /* BOTONES FLOTANTES */
    .btn-float-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 9999;
    }

    .btn-nav {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 18px 8px 8px;
        color: white;
        text-decoration: none;
        border-radius: 50px;
        font-weight: 700;
        font-size: 0.85rem;
        border: 2px solid rgba(255, 255, 255, 0.1);
        transition: 0.4s;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    .nav-report { background: linear-gradient(135deg, #FF9800 0%, #ed6c02 100%); }
    .nav-home { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
    .icon-circle { background: rgba(255,255,255,0.2); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

</style>
</head>
<body>

<header>
    <h2>Generador de Accesos</h2>
    <div class="subtitle">MOVISTAR EL SALVADOR</div>
</header>

<div class="form-card">
    <label>Sitio</label>
    <div style="position: relative;">
        <input type="text" id="sitio" placeholder="Buscar sitio..." autocomplete="off">
        <div id="listaSitios"></div>
    </div>

    <label>Actividad</label>
    <select id="actividad"><option value="">Seleccione...</option></select>

    <label>Veh칤culo</label>
    <select id="vehiculo"><option value="">Seleccione...</option></select>

    <label>T칠cnico Principal (L칤der)</label>
    <select id="tecnicoPrincipal"><option value="">Seleccione...</option></select>

    <label>T칠cnicos de Apoyo</label>
    <div id="tecnicosAdicionales"></div>
    <div id="contadorSeleccionados">Seleccionados: 0</div>

    <label>Vista Previa del Mensaje</label>
    <textarea id="vistaPrevia" readonly></textarea>

    <button id="generar">COPIAR MENSAJE</button>
    <button id="whatsapp">ENVIAR WHATSAPP</button>
</div>

<div class="btn-float-container">
    <a href="pag2.html" class="btn-nav nav-report">
        <div class="icon-circle">游닇</div>
        <span>Reportes</span>
    </a>
    <a href="index.html" class="btn-nav nav-home">
        <div class="icon-circle">游</div>
        <span>Inicio</span>
    </a>
</div>

<script>
let sitios=[], actividades=[], tecnicos=[], vehiculos=[];

async function cargarCSV(url){
    const res = await fetch(url);
    const text = await res.text();
    const lineas = text.trim().split('\n');
    const headers = lineas[0].split(';');
    return lineas.slice(1).map(l=>{
        const cols = l.split(';'); let obj={};
        headers.forEach((h,i)=>obj[h.trim()]=cols[i]?.trim());
        return obj;
    });
}

async function inicializar(){
    sitios = await cargarCSV('sitios.csv');
    actividades = await cargarCSV('actividad.csv');
    tecnicos = await cargarCSV('tecnicos.csv');
    vehiculos = await cargarCSV('vehiculos.csv');

    const selAct = document.getElementById('actividad');
    actividades.forEach(a=>{
        if(a['ACTIVIDAD']) {
            const opt = document.createElement('option');
            opt.value = a['ACTIVIDAD']; opt.textContent = a['ACTIVIDAD'];
            selAct.appendChild(opt);
        }
    });

    const selVeh = document.getElementById('vehiculo');
    vehiculos.forEach(v=>{
        const opt = document.createElement('option');
        opt.value = v.Placa; opt.textContent = `${v.Placa} - ${v.Marca}`;
        selVeh.appendChild(opt);
    });

    const selTecPrin = document.getElementById('tecnicoPrincipal');
    const divTecAdd = document.getElementById('tecnicosAdicionales');

    tecnicos.forEach((t,i)=>{
        const opt = document.createElement('option'); opt.value=i; opt.textContent=`${t.TECNICO}`;
        selTecPrin.appendChild(opt);

        const chip = document.createElement('div');
        chip.className='chip'; chip.textContent=t.TECNICO;
        chip.dataset.index=i;
        chip.onclick=()=>{
            if(parseInt(selTecPrin.value)===i) return;
            chip.classList.toggle('selected'); actualizarPreview(); actualizarContador();
        };
        divTecAdd.appendChild(chip);
    });

    selTecPrin.onchange=()=>{
        document.querySelectorAll('#tecnicosAdicionales .chip').forEach(chip=>{
            const idx=parseInt(chip.dataset.index);
            if(idx===parseInt(selTecPrin.value)){
                chip.classList.remove('selected');
                chip.classList.add('disabled');
            }else{ chip.classList.remove('disabled'); }
        });
        actualizarPreview(); actualizarContador();
    };
    actualizarPreview();
}

function actualizarContador(){
    const count=document.querySelectorAll('#tecnicosAdicionales .chip.selected').length;
    document.getElementById('contadorSeleccionados').textContent=`Seleccionados: ${count}`;
}

const inputSitio=document.getElementById('sitio');
const lista=document.getElementById('listaSitios');
inputSitio.oninput=()=>{
    const val=inputSitio.value.toLowerCase();
    lista.innerHTML='';
    if(!val) return;
    sitios.filter(s=>s['Nombre de Sitio'].toLowerCase().includes(val) || s.SiteID.toLowerCase().includes(val))
        .slice(0,5).forEach(s=>{
            const div=document.createElement('div');
            div.textContent=`${s.SiteID} - ${s['Nombre de Sitio']}`;
            div.onclick=()=>{
                inputSitio.value=s['Nombre de Sitio'];
                inputSitio.dataset.siteid=s.SiteID;
                inputSitio.dataset.torrero=s.Torrero;
                inputSitio.dataset.nombretorrero=s['Nombre Torrero'];
                lista.innerHTML=''; actualizarPreview();
            };
            lista.appendChild(div);
        });
};

function generarMensaje(){
    const sid = inputSitio.dataset.siteid;
    const act = document.getElementById('actividad').value;
    const tecIdx = document.getElementById('tecnicoPrincipal').value;
    if(!sid || !act || tecIdx==="") return "Esperando datos...";

    const veh = vehiculos[document.getElementById('vehiculo').selectedIndex-1]||{};
    const tPrin = tecnicos[tecIdx];
    const tAdd = Array.from(document.querySelectorAll('.chip.selected')).map(c=>tecnicos[c.dataset.index]);
    const todos = [tPrin, ...tAdd];

    const tecBlock = todos.map(t=>`${t.TECNICO}\t${t.DUI} (${t['FECHA DE NACIMIENTO']})`).join('\n');

    return `BUEN DIA\nSU AYUDA CON EL SIGUIENTE ACCESO POR FAVOR :\n郊석둷郊석둷郊석둷郊석둷郊석둷\nID:${sid}\nNOMBRE: ${inputSitio.value}\nPROPIETARIO: ${inputSitio.dataset.torrero}\nNombre Torrero: ${inputSitio.dataset.nombretorrero}\n郊석둷郊석둷郊석둷郊석둷郊석둷\nACTIVIDAD: ${act}\n郊석둷郊석둷郊석둷郊석둷郊석둷\nTECNICOS/DUI\n${tecBlock}\n郊석둷郊석둷郊석둷郊석둷郊석둷\nPlaca: ${veh.Placa||''}\nMarca: ${veh.Marca||''}\nModelo: ${veh.Modelo||''}\nColor: ${veh.Color||''}\n郊석둷郊석둷郊석둷郊석둷郊석둷\nEmpresa: CELECT SA DE CV\nSupervisor: Jos칠 Rivas\nTel: 6161 4465\n郊석둷郊석둷郊석둷郊석둷郊석둷\nTEL: ${tPrin.TELEFONO||''}\nCORREO: ${tPrin.CORREO||''} tecnicossv@celectcac.com`;
}

function actualizarPreview(){ document.getElementById('vistaPrevia').value=generarMensaje(); }

document.getElementById('actividad').onchange = actualizarPreview;
document.getElementById('vehiculo').onchange = actualizarPreview;

document.getElementById('generar').onclick=()=>{
    navigator.clipboard.writeText(document.getElementById('vistaPrevia').value);
    alert('춰Copiado!');
};

document.getElementById('whatsapp').onclick=()=>{
    window.open(`https://wa.me/?text=${encodeURIComponent(document.getElementById('vistaPrevia').value)}`,'_blank');
};

inicializar();
</script>
</body>
</html>
