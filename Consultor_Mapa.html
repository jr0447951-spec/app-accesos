<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultor Acceso - Network Ops</title>
    <style>
        :root { 
            --primary: #00a1ff; 
            --dark-bg: #0f172a;
            --glass: rgba(255, 255, 255, 0.07);
        }

        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            margin:0; padding-bottom: 40px; 
            display: flex; flex-direction: column; align-items: center; 
            color: white; min-height: 100vh;
            background: radial-gradient(circle at top right, #1e293b, var(--dark-bg));
            overflow-x: hidden;
        }

        /* FONDO */
        body::after {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0, 161, 255, 0.05) 1px, transparent 1px), 
                              linear-gradient(90deg, rgba(0, 161, 255, 0.05) 1px, transparent 1px);
            background-size: 30px 30px; z-index: -2;
        }

        header { 
            width: 100%; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px);
            padding: 15px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
            text-align: center; position: sticky; top: 0; z-index: 2000; 
        }

        .search-container { width: 92%; max-width: 500px; margin: 20px 0; position: relative; }
        #siteSearch { 
            width: 100%; padding: 18px 50px 18px 18px; font-size: 1rem; border-radius: 16px; 
            border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1);
            color: white; outline: none; backdrop-filter: blur(10px);
        }

        #clearBtn {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            background: rgba(255,255,255,0.2); border: none; color: white;
            width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: none;
        }

        .suggestions { 
            position: absolute; top: 100%; left: 0; right: 0; 
            background: #1e293b; border-radius: 12px; max-height: 300px; 
            overflow-y: auto; z-index: 1000; display: none; margin-top: 8px; border: 1px solid var(--primary);
        }
        .suggestion-item { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }

        /* CARD Y MAPA */
        .card { 
            background: var(--glass); backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px; 
            width: 92%; max-width: 500px; padding: 20px; box-sizing: border-box;
            animation: fadeIn 0.3s ease-out;
        }

        .header-title { 
            background: rgba(0, 161, 255, 0.15); padding: 15px; border-radius: 18px; 
            text-align: center; margin-bottom: 12px; border: 1px dashed var(--primary);
            cursor: pointer;
        }

        .map-container {
            width: 100%; height: 180px; border-radius: 15px; overflow: hidden;
            margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.2);
            background: #000;
        }

        .info-grid { display: grid; gap: 12px; }
        .info-box { border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px; }
        .label { font-size: 0.7rem; color: var(--primary); font-weight: 800; text-transform: uppercase; }
        .val { font-size: 0.95rem; color: #fff; }

        .go-button { 
            display: block; background: linear-gradient(135deg, var(--primary), #0072ff); 
            color: white; text-align: center; padding: 16px; border-radius: 14px; 
            text-decoration: none; font-weight: 700; margin-top: 20px;
        }

        @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }
    </style>
</head>
<body>

<header>
    <h1>Consultor de Acceso</h1>
    <div id="status" style="font-size:0.6rem; color:var(--primary);">ðŸ“¡ Sincronizando...</div>
</header>

<div class="search-container">
    <input type="text" id="siteSearch" placeholder="ðŸ” Buscar ID o Nombre..." autocomplete="off">
    <button id="clearBtn" onclick="limpiarBusqueda()">âœ•</button>
    <div id="suggestions" class="suggestions"></div>
</div>

<div id="result"></div>

<script>
let sites = [];
const input = document.getElementById('siteSearch');
const clearBtn = document.getElementById('clearBtn');
const sugDiv = document.getElementById('suggestions');
const resultDiv = document.getElementById('result');

const SHEETS_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTE_5CZtD7qHGW5cWHGAjn7ALTphVm5h88lco9cySYoAe2VBW4fq8DQ7-SZY6cd_FHtNQJS3MpE88hs/pub?gid=1955381502&single=true&output=csv';

fetch(SHEETS_CSV_URL).then(res => res.text()).then(data => {
    const rows = data.split(/\r?\n/).filter(row => row.trim().length > 0);
    const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));
    sites = rows.slice(1).map(row => {
        const values = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        let obj = {};
        headers.forEach((h, i) => obj[h] = values[i] ? values[i].trim().replace(/"/g, '') : '');
        return obj;
    });
    document.getElementById('status').innerText = `âœ… RED LISTA`;
});

input.addEventListener('input', (e) => {
    const query = e.target.value.toLowerCase().trim();
    clearBtn.style.display = query.length > 0 ? 'flex' : 'none';
    if (query.length < 2) { sugDiv.style.display = 'none'; return; }
    const matches = sites.filter(s => s.SITEID.toLowerCase().includes(query) || s['NOMBRE DE SITIO'].toLowerCase().includes(query)).slice(0, 8);
    if (matches.length > 0) {
        sugDiv.innerHTML = matches.map(s => `<div class="suggestion-item" onclick="seleccionarSitio('${s.SITEID}')"><strong>${s.SITEID}</strong><br><small>${s['NOMBRE DE SITIO']}</small></div>`).join('');
        sugDiv.style.display = 'block';
    }
});

function limpiarBusqueda() {
    input.value = ''; clearBtn.style.display = 'none'; sugDiv.style.display = 'none'; resultDiv.innerHTML = '';
}

function seleccionarSitio(id) {
    const s = sites.find(item => item.SITEID === id);
    sugDiv.style.display = 'none';
    input.value = s['NOMBRE DE SITIO'];
    
    // URL del mapa corregida para mÃ³viles
    const mapUrl = `https://maps.google.com/maps?q=${s.LATITUDE},${s.LONGITUDE}&z=15&output=embed`;

    resultDiv.innerHTML = `
        <div class="card">
            <div class="header-title" onclick="copiarTexto('${s.SITEID} - ${s['NOMBRE DE SITIO']}')">
                <h2 style="margin:0; font-size:1.1rem;">${s.SITEID} - ${s['NOMBRE DE SITIO']}</h2>
                <span id="copyLabel" style="font-size:0.6rem; color:var(--primary); font-weight:bold;">TAP PARA COPIAR</span>
            </div>

            <div class="map-container">
                <iframe width="100%" height="100%" frameborder="0" style="border:0" src="${mapUrl}" allowfullscreen></iframe>
            </div>

            <div class="info-grid">
                <div class="info-box"><span class="label">NIC/NIS:</span><br><span class="val" style="color:#fbbf24; font-weight:bold;">${s['NIC/NIS'] || 'N/A'}</span></div>
                <div class="info-box"><span class="label">Municipio:</span><br><span class="val">${s.Municipio || 'N/A'}</span></div>
                <div class="info-box" style="border:none"><span class="label">DirecciÃ³n:</span><br><span class="val">${s.DIRECCION || s['DirecciÃ³n'] || 'N/A'}</span></div>
            </div>
            
            <a href="https://www.google.com/maps/search/?api=1&query=${s.LATITUDE},${s.LONGITUDE}" target="_blank" class="go-button">ðŸš€ ABRIR EN GOOGLE MAPS</a>
        </div>
    `;
}

function copiarTexto(texto) {
    navigator.clipboard.writeText(texto).then(() => {
        const label = document.getElementById('copyLabel');
        label.innerText = "Â¡COPIADO!";
        setTimeout(() => label.innerText = "TAP PARA COPIAR", 1500);
    });
}
</script>
</body>
</html>
