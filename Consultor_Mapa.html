<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultor Acceso - Network Ops</title>
    <style>
        :root { 
            --primary: #00a1ff; 
            --dark-bg: #0f172a;
            --glass: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.15);
        }

        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            margin: 0; padding-bottom: 50px; 
            background: radial-gradient(circle at top right, #1e293b, var(--dark-bg));
            color: white; min-height: 100vh;
        }

        header { 
            width: 100%; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(12px);
            padding: 12px 0; position: sticky; top: 0; z-index: 2000;
            border-bottom: 1px solid var(--border); text-align: center;
        }

        .search-area { width: 92%; max-width: 500px; margin: 15px auto; position: relative; }
        #siteSearch { 
            width: 100%; padding: 16px 45px 16px 18px; font-size: 1rem; border-radius: 14px; 
            border: 1px solid var(--border); background: rgba(255,255,255,0.05);
            color: white; outline: none; box-sizing: border-box;
        }
        #clearBtn {
            position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
            background: rgba(255,255,255,0.15); border: none; color: white;
            width: 28px; height: 28px; border-radius: 50%; display: none; cursor: pointer;
        }

        .suggestions { 
            position: absolute; top: 100%; left: 0; right: 0; 
            background: #1e293b; border-radius: 12px; max-height: 250px; 
            overflow-y: auto; z-index: 3000; display: none; margin-top: 5px; border: 1px solid var(--primary);
        }
        .suggestion-item { padding: 14px; border-bottom: 1px solid var(--border); cursor: pointer; }

        /* FICHA TÃ‰CNICA */
        #result { width: 92%; max-width: 500px; margin: 0 auto; scroll-margin-top: 100px; }
        
        .card { 
            background: var(--glass); backdrop-filter: blur(15px);
            border: 1px solid var(--border); border-radius: 24px; padding: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4); animation: fadeIn 0.3s ease-out;
        }

        /* 1. SITEID - NOMBRE */
        .header-title { 
            background: rgba(0, 161, 255, 0.15); padding: 18px; border-radius: 16px; 
            text-align: center; margin-bottom: 15px; border: 1px dashed var(--primary); cursor: pointer;
        }
        .header-title h2 { margin: 0; font-size: 1.1rem; text-transform: uppercase; }
        .copy-tag { font-size: 0.65rem; color: var(--primary); font-weight: bold; margin-top: 6px; display: block; }

        /* 2. MINI MAPA */
        .map-box { 
            width: 100%; height: 200px; border-radius: 16px; overflow: hidden; 
            margin-bottom: 20px; border: 1px solid var(--border); background: #000;
        }

        /* DATOS EN ORDEN */
        .info-list { display: flex; flex-direction: column; gap: 10px; }
        .info-item { background: rgba(255,255,255,0.03); padding: 10px 14px; border-radius: 12px; border-left: 4px solid var(--primary); }
        .info-label { font-size: 0.65rem; color: var(--primary); font-weight: 800; text-transform: uppercase; margin-bottom: 2px; display: block; }
        .info-val { font-size: 1rem; color: #fff; font-weight: 500; }
        
        /* 5. LLAVE (ALERTA ROJA) */
        .key-alert { 
            background: #be123c; border-left: 4px solid #ff4d4d; color: white; 
            padding: 12px; border-radius: 12px; font-weight: bold; display: flex; 
            align-items: center; gap: 10px; margin-bottom: 10px;
        }

        /* BOTÃ“N GPS */
        .btn-gps { 
            display: flex; align-items: center; justify-content: center; gap: 10px;
            background: linear-gradient(135deg, var(--primary), #0072ff); color: white; 
            padding: 18px; border-radius: 16px; text-decoration: none; font-weight: 800; margin-top: 25px;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header>
    <h1 style="margin:0; font-size:1.1rem;">Network Ops Access</h1>
</header>

<div class="search-area">
    <input type="text" id="siteSearch" placeholder="ðŸ” ID o Nombre del sitio..." autocomplete="off">
    <button id="clearBtn" onclick="limpiar()">âœ•</button>
    <div id="suggestions" class="suggestions"></div>
</div>

<div id="result"></div>

<script>
let sites = [];
const input = document.getElementById('siteSearch');
const clearBtn = document.getElementById('clearBtn');
const sugDiv = document.getElementById('suggestions');
const resultDiv = document.getElementById('result');

const SHEETS_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTE_5CZtD7qHGW5cWHGAjn7ALTphVm5h88lco9cySYoAe2VBW4fq8DQ7-SZY6cd_FHtNQJS3MpE88hs/pub?gid=1955381502&single=true&output=csv';

fetch(SHEETS_CSV_URL).then(r => r.text()).then(data => {
    const rows = data.split(/\r?\n/).filter(row => row.trim().length > 0);
    const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));
    sites = rows.slice(1).map(row => {
        const values = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        let obj = {};
        headers.forEach((h, i) => obj[h] = values[i] ? values[i].trim().replace(/"/g, '') : '');
        return obj;
    });
});

input.addEventListener('input', (e) => {
    const val = e.target.value.toLowerCase().trim();
    clearBtn.style.display = val.length > 0 ? 'flex' : 'none';
    if (val.length < 2) { sugDiv.style.display = 'none'; return; }
    const matches = sites.filter(s => s.SITEID.toLowerCase().includes(val) || s['NOMBRE DE SITIO'].toLowerCase().includes(val)).slice(0, 8);
    sugDiv.innerHTML = matches.map(s => `<div class="suggestion-item" onclick="seleccionar('${s.SITEID}')"><strong>${s.SITEID}</strong><br><small>${s['NOMBRE DE SITIO']}</small></div>`).join('');
    sugDiv.style.display = matches.length ? 'block' : 'none';
});

function limpiar() { input.value = ''; clearBtn.style.display = 'none'; sugDiv.style.display = 'none'; resultDiv.innerHTML = ''; }

function seleccionar(id) {
    const s = sites.find(x => x.SITEID === id);
    sugDiv.style.display = 'none';
    input.value = s['NOMBRE DE SITIO'];
    
    // LÃ³gica condicional de Llave
    const llaveHTML = (s['Llave Requerida']?.toUpperCase() === 'SI') ? 
        `<div class="key-alert">ðŸ”‘ LLAVE NECESARIA PARA ACCESO</div>` : '';

    const mapUrl = `https://maps.google.com/maps?q=${s.LATITUDE},${s.LONGITUDE}&z=15&output=embed`;

    resultDiv.innerHTML = `
        <div class="card">
            <div class="header-title" onclick="copiar('${s.SITEID} - ${s['NOMBRE DE SITIO']}')">
                <h2>${s.SITEID} - ${s['NOMBRE DE SITIO']}</h2>
                <span id="copyLabel" class="copy-tag">TAP PARA COPIAR</span>
            </div>

            <div class="map-box">
                <iframe width="100%" height="100%" frameborder="0" src="${mapUrl}"></iframe>
            </div>

            <div class="info-list">
                <div class="info-item"><span class="info-label">NIC / NIS</span><span class="info-val" style="color:#fbbf24;">${s['NIC/NIS'] || 'N/A'}</span></div>
                
                <div class="info-item"><span class="info-label">Distribuidora</span><span class="info-val">${s.Distribuidora || 'N/A'}</span></div>
                
                ${llaveHTML}

                <div class="info-item"><span class="info-label">Porte</span><span class="info-val">${s.Porte || 'N/A'}</span></div>
                <div class="info-item"><span class="info-label">Altura</span><span class="info-val">${s.Altura || 'N/A'}</span></div>

                <div class="info-item"><span class="info-label">Municipio</span><span class="info-val">${s.Municipio || 'N/A'}</span></div>

                <div class="info-item"><span class="info-label">DirecciÃ³n Exacta</span><span class="info-val">${s.DIRECCION || s['DirecciÃ³n'] || 'N/A'}</span></div>
            </div>

            <a href="https://www.google.com/maps/search/?api=1&query=${s.LATITUDE},${s.LONGITUDE}" target="_blank" class="btn-gps">
                ðŸš€ INICIAR GPS
            </a>
        </div>
    `;
    
    setTimeout(() => {
        resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 150);
}

function copiar(txt) {
    navigator.clipboard.writeText(txt);
    const lbl = document.getElementById('copyLabel');
    lbl.innerText = "Â¡COPIADO!"; lbl.style.color = "#22c55e";
    setTimeout(() => { lbl.innerText = "TAP PARA COPIAR"; lbl.style.color = "var(--primary)"; }, 1500);
}

document.addEventListener('click', (e) => { if (!input.contains(e.target)) sugDiv.style.display = 'none'; });
</script>
</body>
</html>
