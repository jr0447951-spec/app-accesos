<script>
let sitios = [];

fetch("Mapa_Base.kml")
  .then(r=>r.text())
  .then(text=>{
    const xml = new DOMParser().parseFromString(text,"text/xml");
    const placemarks = [...xml.getElementsByTagName("Placemark")];

    sitios = placemarks.map(p=>{
      const name = p.getElementsByTagName("name")[0]?.textContent || "";
      const coord = p.getElementsByTagName("coordinates")[0]?.textContent.trim();
      const [lon, lat] = coord.split(",");

      const data = {};
      [...p.getElementsByTagName("Data")].forEach(d=>{
        data[d.getAttribute("name")] =
          d.getElementsByTagName("value")[0]?.textContent || "";
      });

      const desc = p.getElementsByTagName("description")[0]?.textContent || "";

      return { name, lat, lon, data, desc };
    });
  });
</script>
