<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Consulta de Enlaces con PIN</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  body {
    margin: 0;
    min-height: 100vh;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: linear-gradient(180deg, #f6f8fb, #eaeff5);
    display: flex;
    justify-content: center;
    align-items: center;
    color: #2c3e50;
  }
  .app {
    width: 100%;
    max-width: 600px;
    margin: 16px;
    background: #fff;
    border-radius: 18px;
    padding: 20px;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
    display: none; /* oculto hasta validar PIN */
  }
  h1 {
    text-align: center;
    font-size: 1.4rem;
    margin-bottom: 14px;
  }
  input {
    width: 100%;
    padding: 12px 14px;
    font-size: 1rem;
    border-radius: 12px;
    border: 1px solid #ccc;
  }
  .suggestions {
    position: absolute;
    width: calc(100% - 40px);
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
    margin-top: 6px;
    max-height: 220px;
    overflow: auto;
    z-index: 10;
  }
  .suggestions div {
    padding: 10px 14px;
    cursor: pointer;
  }
  .suggestions div:hover {
    background: #f2f5f9;
  }
  .hidden {
    display: none;
  }
  .result {
    margin-top: 20px;
  }
  .link-title {
    text-align: center;
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 14px;
  }
  .card {
    background: #f9fbfe;
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 14px;
    border: 1px solid #e3e8ef;
  }
  .card h2 {
    margin: 0 0 10px;
    font-size: 1rem;
    color: #1a4fd8;
  }
  .row {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    font-size: 0.95rem;
  }
  .label {
    color: #6b7280;
  }
  .value {
    font-weight: 600;
  }

  /* Modal PIN */
  #pinModal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  #pinBox {
    background: white;
    border-radius: 14px;
    padding: 24px 32px;
    box-shadow: 0 10px 28px rgba(0,0,0,0.2);
    width: 320px;
    max-width: 90vw;
    text-align: center;
  }
  #pinBox h2 {
    margin-bottom: 16px;
    font-weight: 600;
  }
  #pinInput {
    width: 100%;
    font-size: 1.3rem;
    padding: 12px 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    text-align: center;
    letter-spacing: 6px;
  }
  #pinError {
    margin-top: 10px;
    color: #d93025;
    font-weight: 600;
    min-height: 2.4em;
    white-space: pre-line;
  }
  #pinSubmit {
    margin-top: 20px;
    background: #1a4fd8;
    color: white;
    border: none;
    padding: 12px 0;
    width: 100%;
    border-radius: 10px;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  #pinSubmit:hover {
    background: #1343bb;
  }
</style>
</head>
<body>

<!-- Modal PIN -->
<div id="pinModal">
  <div id="pinBox">
    <h2>Ingrese el PIN de seguridad</h2>
    <input id="pinInput" type="password" maxlength="8" autocomplete="off" autofocus placeholder="Ingrese el PIN de seguridad" />
    <div id="pinError"></div>
    <button id="pinSubmit">Entrar</button>
  </div>
</div>

<!-- App -->
<div class="app" id="app">
  <h1>Consulta de Enlaces</h1>
  <input id="search" placeholder="Buscar sitio (ej: JAYAQUE)" autocomplete="off" />
  <div id="suggestions" class="suggestions hidden"></div>
  <div id="result" class="result hidden"></div>
</div>

<script>
// Cambia aquí tu PIN deseado
const CORRECT_PIN = "0614";

const pinModal = document.getElementById("pinModal");
const pinInput = document.getElementById("pinInput");
const pinError = document.getElementById("pinError");
const pinSubmit = document.getElementById("pinSubmit");
const app = document.getElementById("app");

pinSubmit.addEventListener("click", checkPin);
pinInput.addEventListener("keypress", e => {
  if (e.key === "Enter") checkPin();
});

function checkPin(){
  const pin = pinInput.value.trim();
  if(pin === CORRECT_PIN){
    pinModal.style.display = "none";
    app.style.display = "block";
    loadData();
  } else {
    pinError.textContent = "USTED NO ESTÁ AUTORIZADO\nComuníquese con el administrador";
    pinInput.value = "";
    pinInput.placeholder = "Ingrese el PIN de seguridad";
    pinInput.focus();
  }
}

let rawData = [];
let parsedLinks = [];

function loadData(){
  fetch("IPdata.csv")
  .then(r=>r.text())
  .then(text=>{
    const lines=text.trim().split("\n");
    const headers=lines.shift().split(";").map(h=>h.trim());

    let currentLink="";
    rawData = [];
    lines.forEach(l=>{
      const v=l.split(";").map(x=>x.trim());
      let obj={};
      headers.forEach((h,i)=>obj[h]=v[i]||"");

      if(obj["Enlace"]) currentLink=obj["Enlace"];
      obj._link=currentLink;

      rawData.push(obj);
    });

    buildLinks();
  });
}

function buildLinks(){
  const grouped={};

  rawData.forEach(d=>{
    if(!grouped[d._link]) grouped[d._link]=[];
    grouped[d._link].push(d);
  });

  parsedLinks = Object.entries(grouped).map(([link,items])=>{
    if(items.length!==2) return null;

    const a=items[0], b=items[1];
    return {
      link,
      a:{
        title:`${a["Sitio"]} > ${b["Sitio"]}`,
        ip:a["ultima IP"],
        mask:a["Mask"],
        gw:a["IP"]
      },
      b:{
        title:`${b["Sitio"]} > ${a["Sitio"]}`,
        ip:b["ultima IP"],
        mask:b["Mask"],
        gw:b["IP"]
      },
      sites:[a["Sitio"],b["Sitio"]]
    };
  }).filter(Boolean);
}

const search=document.getElementById("search");
const sug=document.getElementById("suggestions");
const result=document.getElementById("result");

search.addEventListener("input",()=>{
  const v=search.value.toUpperCase();
  sug.innerHTML="";
  if(!v){sug.classList.add("hidden");result.classList.add("hidden");return;}

  const sites=[...new Set(parsedLinks.flatMap(l=>l.sites))]
    .filter(s=>s.toUpperCase().includes(v))
    .slice(0,6);

  sites.forEach(s=>{
    const d=document.createElement("div");
    d.textContent=s;
    d.onclick=()=>selectSite(s);
    sug.appendChild(d);
  });

  sug.classList.toggle("hidden",sites.length===0);
});

function selectSite(site){
  search.value=site;
  sug.classList.add("hidden");
  show(site);
}

function show(site){
  result.innerHTML="";
  const links=parsedLinks.filter(l=>l.sites.includes(site));

  links.forEach(l=>{
    const title=document.createElement("div");
    title.className="link-title";
    title.textContent=l.link;
    result.appendChild(title);

    result.appendChild(makeCard(l.a));
    result.appendChild(makeCard(l.b));
  });

  result.classList.remove("hidden");
}

function makeCard(d){
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`
    <h2>${d.title}</h2>
    <div class="row"><span class="label">IP PC</span><span class="value">${d.ip}</span></div>
    <div class="row"><span class="label">Máscara</span><span class="value">${d.mask}</span></div>
    <div class="row"><span class="label">Puerta de enlace</span><span class="value">${d.gw}</span></div>
  `;
  return c;
}
</script>

</body>
</html>

