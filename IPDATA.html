<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Consulta de Enlaces</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  min-height:100vh;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  background:linear-gradient(180deg,#f6f8fb,#eaeff5);
  display:flex;
  justify-content:center;
  align-items:center;
}

.app{
  width:100%;
  max-width:600px;
  margin:16px;
  background:#fff;
  border-radius:18px;
  padding:20px;
  box-shadow:0 12px 30px rgba(0,0,0,.08);
}

h1{
  text-align:center;
  font-size:1.4rem;
  margin-bottom:14px;
}

input{
  width:100%;
  padding:12px 14px;
  font-size:1rem;
  border-radius:12px;
  border:1px solid #ccc;
}

.suggestions{
  position:absolute;
  width:calc(100% - 40px);
  background:#fff;
  border-radius:12px;
  box-shadow:0 6px 18px rgba(0,0,0,.15);
  margin-top:6px;
  max-height:220px;
  overflow:auto;
  z-index:10;
}

.suggestions div{
  padding:10px 14px;
  cursor:pointer;
}
.suggestions div:hover{
  background:#f2f5f9;
}

.hidden{display:none;}

.result{
  margin-top:20px;
}

.link-title{
  text-align:center;
  font-weight:600;
  font-size:1.1rem;
  margin-bottom:14px;
}

.card{
  background:#f9fbfe;
  border-radius:16px;
  padding:16px;
  margin-bottom:14px;
  border:1px solid #e3e8ef;
}

.card h2{
  margin:0 0 10px;
  font-size:1rem;
  color:#1a4fd8;
}

.row{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  font-size:.95rem;
}

.label{color:#6b7280;}
.value{font-weight:600;}
</style>
</head>

<body>

<div class="app">
  <h1>Consulta de Enlaces</h1>

  <input id="search" placeholder="Buscar sitio (ej: JAYAQUE)" autocomplete="off">
  <div id="suggestions" class="suggestions hidden"></div>

  <div id="result" class="result hidden"></div>
</div>

<script>
let rawData = [];
let parsedLinks = [];

// Cargar CSV
fetch("IPdata.csv")
.then(r=>r.text())
.then(text=>{
  const lines=text.trim().split("\n");
  const headers=lines.shift().split(";").map(h=>h.trim());

  let currentLink="";
  lines.forEach(l=>{
    const v=l.split(";").map(x=>x.trim());
    let obj={};
    headers.forEach((h,i)=>obj[h]=v[i]||"");

    if(obj["Enlace"]) currentLink=obj["Enlace"];
    obj._link=currentLink;

    rawData.push(obj);
  });

  buildLinks();
});

function buildLinks(){
  const grouped={};

  rawData.forEach(d=>{
    if(!grouped[d._link]) grouped[d._link]=[];
    grouped[d._link].push(d);
  });

  parsedLinks = Object.entries(grouped).map(([link,items])=>{
    if(items.length!==2) return null;

    const a=items[0], b=items[1];
    return {
      link,
      a:{
        title:`${a["Sitio"]} > ${b["Sitio"]}`,
        ip:a["ultima IP"],
        mask:a["Mask"],
        gw:a["IP"]
      },
      b:{
        title:`${b["Sitio"]} > ${a["Sitio"]}`,
        ip:b["ultima IP"],
        mask:b["Mask"],
        gw:b["IP"]
      },
      sites:[a["Sitio"],b["Sitio"]]
    };
  }).filter(Boolean);
}

// AUTOCOMPLETADO
const search=document.getElementById("search");
const sug=document.getElementById("suggestions");
const result=document.getElementById("result");

search.addEventListener("input",()=>{
  const v=search.value.toUpperCase();
  sug.innerHTML="";
  if(!v){sug.classList.add("hidden");result.classList.add("hidden");return;}

  const sites=[...new Set(parsedLinks.flatMap(l=>l.sites))]
    .filter(s=>s.toUpperCase().includes(v))
    .slice(0,6);

  sites.forEach(s=>{
    const d=document.createElement("div");
    d.textContent=s;
    d.onclick=()=>selectSite(s);
    sug.appendChild(d);
  });

  sug.classList.toggle("hidden",sites.length===0);
});

function selectSite(site){
  search.value=site;
  sug.classList.add("hidden");
  show(site);
}

function show(site){
  result.innerHTML="";
  const links=parsedLinks.filter(l=>l.sites.includes(site));

  links.forEach(l=>{
    const title=document.createElement("div");
    title.className="link-title";
    title.textContent=l.link;
    result.appendChild(title);

    result.appendChild(makeCard(l.a));
    result.appendChild(makeCard(l.b));
  });

  result.classList.remove("hidden");
}

function makeCard(d){
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`
    <h2>${d.title}</h2>
    <div class="row"><span class="label">IP PC</span><span class="value">${d.ip}</span></div>
    <div class="row"><span class="label">MÃ¡scara</span><span class="value">${d.mask}</span></div>
    <div class="row"><span class="label">Puerta de enlace</span><span class="value">${d.gw}</span></div>
  `;
  return c;
}
</script>

</body>
</html>
