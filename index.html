<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Accesos</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0078D4">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      background: #f4f4f4;
    }
    h2 {
      text-align: center;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select, button, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    textarea {
      height: 260px;
      margin-top: 15px;
    }
    button {
      background: #0078D4;
      color: white;
      border: none;
      margin-top: 15px;
      font-size: 16px;
    }
  </style>
</head>

<body>

<h2>游늶 Generador de Accesos</h2>

/* ================= FILTRAR SITIOS POR NOMBRE/ID ================= */
document.getElementById("buscarSitio").addEventListener("input", function() {
  const texto = this.value.toLowerCase(); // Obtener texto en min칰sculas para b칰squeda
  const cmbSitio = document.getElementById("cmbSitio");

  // Limpiar combo de sitios
  cmbSitio.innerHTML = "";

  // Filtrar sitios por ID o Nombre
  const filtrados = sitios.filter(s =>
    s.ID.toLowerCase().includes(texto) ||  // Compara con el ID
    s.Nombre.toLowerCase().includes(texto)  // Compara con el Nombre
  );

  // Verificar si se encontraron sitios
  if (filtrados.length === 0) {
    cmbSitio.add(new Option("No se encontraron resultados", ""));
  } else {
    // Llenar combo con los sitios filtrados
    filtrados.forEach((s) => {
      cmbSitio.add(new Option(`${s.ID} - ${s.Nombre}`, sitios.indexOf(s)));
    });
  }
});

<!-- COMBOS -->
<label>Sitio</label>
<select id="cmbSitio"></select>

<label>Actividad</label>
<select id="actividad"></select>

<label>T칠cnico Principal</label>
<select id="tecnicoPrincipal"></select>

<label>Veh칤culo</label>
<select id="vehiculo"></select>

<button onclick="generarMensaje()">Generar y Copiar</button>

<textarea id="resultado" placeholder="Aqu칤 aparecer치 el mensaje..."></textarea>

<script>
/* ================= VARIABLES ================= */
let sitios = [];
let tecnicos = [];
let vehiculos = [];
let actividades = [];

/* ================= LEER CSV ================= */
async function leerCSV(archivo) {
  const res = await fetch(archivo);
  const texto = await res.text();
  const lineas = texto.split("\n").map(l => l.trim()).filter(l => l);
  const encabezados = lineas[0].split(",");

  return lineas.slice(1).map(linea => {
    const valores = linea.split(",");
    let obj = {};
    encabezados.forEach((h, i) => obj[h] = valores[i]);
    return obj;
  });
}

/* ================= CARGAR DATOS ================= */
async function cargarDatos() {
  sitios = await leerCSV("sitios.csv");
  tecnicos = await leerCSV("tecnicos.csv");
  vehiculos = await leerCSV("vehiculos.csv");
  actividades = await leerCSV("actividad.csv");

  cargarCombos();
}

/* ================= LLENAR COMBOS ================= */
function cargarCombos() {
  const cmbSitio = document.getElementById("cmbSitio");
  const cmbActividad = document.getElementById("actividad");
  const cmbTecnico = document.getElementById("tecnicoPrincipal");
  const cmbVehiculo = document.getElementById("vehiculo");

  sitios.forEach((s, i) => {
    cmbSitio.add(new Option(`${s.ID} - ${s.Nombre}`, i));
  });

  actividades.forEach(a => {
    cmbActividad.add(new Option(a.Actividad, a.Actividad));
  });

  tecnicos.forEach((t, i) => {
    cmbTecnico.add(new Option(t.Nombre, i));
  });

  vehiculos.forEach((v, i) => {
    cmbVehiculo.add(new Option(`${v.Placa} - ${v.Marca}`, i));
  });
}

/* ================= FILTRAR SITIOS POR NOMBRE/ID ================= */
document.getElementById("buscarSitio").addEventListener("input", function() {
  const texto = this.value.toLowerCase();
  const cmbSitio = document.getElementById("cmbSitio");

  // Limpiar combo
  cmbSitio.innerHTML = "";

  // Filtrar sitios por ID o Nombre
  const filtrados = sitios.filter(s =>
    s.ID.toLowerCase().includes(texto) ||
    s.Nombre.toLowerCase().includes(texto)
  );

  // Llenar combo con resultados
  filtrados.forEach((s) => {
    cmbSitio.add(new Option(`${s.ID} - ${s.Nombre}`, sitios.indexOf(s)));
  });
});

/* ================= GENERAR MENSAJE ================= */
function generarMensaje() {
  const cmbSitioSel = document.getElementById("cmbSitio");
  if(cmbSitioSel.value === "") { alert("Selecciona un sitio"); return; }

  const sitio = sitios[cmbSitioSel.value];
  const actividadSel = document.getElementById("actividad").value;
  const tecnico = tecnicos[document.getElementById("tecnicoPrincipal").value];
  const veh = vehiculos[document.getElementById("vehiculo").value];

  const mensaje =
`BUEN DIA
SU AYUDA CON EL SIGUIENTE ACCESO POR FAVOR :
郊석둷郊석둷郊석둷郊석둷郊석둷
ID:${sitio.ID}
NOMBRE: ${sitio.Nombre}
PROPIETARIO: ${sitio.Propietario}
${sitio.Direccion}
郊석둷郊석둷郊석둷郊석둷郊석둷
ACTIVIDAD: ${actividadSel}
郊석둷郊석둷郊석둷郊석둷郊석둷
TECNICO/DUI
${tecnico.Nombre}\t${tecnico.DUI}
郊석둷郊석둷郊석둷郊석둷郊석둷
Placa: ${veh.Placa}
Marca: ${veh.Marca}
Modelo: ${veh.Modelo}
Color: ${veh.Color}
郊석둷郊석둷郊석둷郊석둷郊석둷
TELEFONO: ${tecnico.Telefono}
CORREO: ${tecnico.Correo}; tecnicossv@celectcac.com`;

  document.getElementById("resultado").value = mensaje;

  // Copiar al portapapeles
  navigator.clipboard.writeText(mensaje)
    .then(() => alert("Mensaje copiado al portapapeles"))
    .catch(() => alert("No se pudo copiar"));
}

/* ================= SERVICE WORKER ================= */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}

window.onload = cargarDatos;
</script>

</body>
</html>

